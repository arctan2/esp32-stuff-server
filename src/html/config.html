<head><title>arctan2 server</title></head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
	color: white;
	background-color: black;
	font-family: monospace;
}
button{
	margin: 1rem;
	font-family: monospace;
	padding: 0.5rem 1rem;
}
</style>

<body>
	<h1>arctan2's AP</h1>
	<label for="name">ssid:</label>
	<input type="text" id="ssid" name="ssid" oninput="handleOnChange(this)">
	<br>
	<br>
	<label for="pwd">pwd:</label>
	<input type="text" id="pwd" name="pwd" oninput="handleOnChange(this)">
	<div>
		<button class="btn" onclick="setConfig()" disabled>set_config</button>
		<button class="btn" onclick="writeToFlash()" disabled>write_to_flash</button>
	</div>
	<div>
		<button onclick="connect()">connect</button>
		<button onclick="disconnect()">disconnect</button>
		<button onclick="getFlashData()">get_flash_data</button>
		<button onclick="status()">status</button>
		<button onclick="softwareReset()">software_reset</button>
	</div>
	<pre><code id="status"></code></pre>

<script defer>
	const statusEl = document.getElementById("status");
	const ssidEl = document.getElementById("ssid");
	const pwdEl = document.getElementById("pwd");
	const btns = document.querySelectorAll(".btn");

	async function getReq(name, isJson = false) {
		try {
			statusEl.innerText = `running '${name}'...`;
			const res = await fetch(`/${name}`);
			const data = isJson ? JSON.stringify(await res.json(), null, 4) : await res.text();
			statusEl.innerText = `'${name}' result: ${data}`;
		} catch(e) {
			statusEl.innerText = `Error in '${name}': ${e}`;
		}
	}

	function handleOnChange(obj) {
		const ssid = ssidEl.value;
		const pwd = pwdEl.value;

		if(String(ssid).trim().length > 0 && String(pwd).trim().length > 0) {
			btns.forEach(b => b.disabled = false);
		} else {
			btns.forEach(b => b.disabled = true);
		}
	}

	const postReqObj = { method: "POST", headers: { "Content-Type": "application/json" } };

	async function postReq(name) {
		try {
			statusEl.innerText = `running '${name}'...`;
			const res = await fetch(`/${name}`, {...postReqObj, body: JSON.stringify({ ssid: ssidEl.value, pwd: pwdEl.value })});
			const data = await res.text();
			statusEl.innerText = `'${name}' result: ${data}`;
			ssidEl.value = "";
			pwdEl.value = "";
		} catch(e) {
			statusEl.innerText = `Error in '${name}': ${e}`;
		}
	}

	function setConfig() {
		postReq("set-config");
	}

	function writeToFlash() {
		postReq("write-to-flash");
	}

	function connect() {
		getReq("connect");
	}

	function disconnect() {
		getReq("disconnect");
	}

	function status() {
		getReq("status", true);
	}

	function softwareReset() {
		getReq("software-reset");
	}

	function getFlashData() {
		getReq("get-flash-data", true);
	}

	status();
</script>
</body>
