<style>
*{
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

html {
	background-color: black;
	color: white;
	font-family: monospace;
}

body{
	padding: 1rem;
}

a{
	font-size: 1rem;
	display: inline-block;
	text-decoration: none;
}

.size{
	display: inline-block;
	margin-right: 0.5rem;
	color: yellow;
}

</style>

<input type="file" id="upload" />
<div>
	<button onclick="uploadFile(this)">upload file</button>
</div>

<script>
const aTags = document.querySelectorAll("a");

for(const a of aTags) {
	const isDir = a.innerText[a.innerText.length - 1] === "/";
	let loc = window.location.href;
	if(!loc.endsWith("/")) loc += "/";
	a.href = loc + a.innerText;
	if(isDir) {
		a.style.color = "#00f";
	} else {
		a.style.color = "#fff";
	}
}

async function uploadFile(btn) {
	try {
		btn.disabled = true;
		btn.innerText = "uploading...";

		const fileInput = document.getElementById('upload');
		const file = fileInput.files[0];

		if(!file) return;

		const formData = new FormData();
		formData.append('file', file);

		let pathname = window.location.pathname;

		const response = await fetch(`/upload${pathname}`, {
			method: 'POST',
			body: formData,
		});

		const data = await response.text();

		if(data === "success") {
			alert("Upload successful!");
		} else {
			alert(`error: ${data}`);
		}
		window.location.reload();
	} catch(e) {
		alert(`error: ${e}`);
	}
}

</script>
