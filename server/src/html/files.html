<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{
	margin: 0;
	padding: 0;
	box-sizing: border-box;
}

html {
	background-color: black;
	color: white;
	font-family: monospace;
}

body{
	padding: 1rem;
}

a{
	font-size: 1rem;
	display: inline-block;
	text-decoration: none;
}

.size{
	display: inline-block;
	margin-right: 0.5rem;
	color: yellow;
}

</style>

<input type="file" id="upload" />
<div>
	<button onclick="uploadFile(this)">upload file</button>
</div>

<script>
const aTags = document.querySelectorAll("a");

async function deleteFile(name) {
	const response = await fetch(`/files/delete/${name}`, {
		method: 'DELETE',
	});

	const data = await response.text();

	if(data === "success") {
		alert("deleted successfully!");
	} else {
		alert(`error: ${data}`);
	}
	window.location.reload();
}

for(const a of aTags) {
	let parent = a.parentElement;
	let deleteBtn = document.createElement("button");
	let [actualName, name] = a.innerText.split(";");
	let origin = window.location.origin;

	deleteBtn.style.marginLeft = "1rem";
	deleteBtn.innerText = "delete";
	deleteBtn.addEventListener("click", () => {
		deleteBtn.disabled = true;
		deleteFile(actualName);
	});
	parent.appendChild(deleteBtn);

	a.href = `${origin}/fs/files/${actualName}`;
	a.innerText = name;
	a.style.color = "#fff";
}

async function uploadFile(btn) {
	try {
		btn.disabled = true;
		btn.innerText = "uploading...";

		const fileInput = document.getElementById('upload');
		const file = fileInput.files[0];

		if(!file) return;

		const fileName = file.name; 
		const parts = fileName.split('.');
		let extension = "bin";

		if(parts.length > 1) {
			extension = parts.pop();
		}

		const formData = new FormData();
		formData.append('file', file);

		const response = await fetch(`/upload/file?ext=${extension}`, {
			method: 'POST',
			body: formData,
		});

		const data = await response.text();

		if(data === "success") {
			alert("Upload successful!");
		} else {
			alert(`error: ${data}`);
		}
		window.location.reload();
	} catch(e) {
		alert(`error: ${e}`);
	}
}

</script>
